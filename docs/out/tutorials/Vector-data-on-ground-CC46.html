<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial : Vector visualization - Projected on the ground</title>

    <script src="../scripts/prettify/prettify.js"> </script>
    <script src="../scripts/prettify/lang-css.js"> </script>
    <link type="text/css" rel="stylesheet" href="../styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="../styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="../styles/itowns.css">
</head>

<body>

<section>

<header>
    <h1>Tutorial : Vector visualization - Projected on the ground</h1>
</header>

<article>
    <p>The goal of this tutorial is to give an example on how to use iTowns to visualize some vector data projected on the ground.
These data are contained within two GeoJSON files that you can find
<a href="https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-hydro.geojson">here</a> and
<a href="https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-roads.geojson">here</a>.
The first file data consist in polygons which represent river areas around Lyon city.
The second file data consist in lines, representing important transportation axises in the same area.
These data shall be displayed on a <code>PlanarView</code>, as the one created in the <a href="Raster-data-CC46.md">CC46 tutorial</a>.</p>
<h2>Preparing the field</h2>
<p>We are going to use the data displayed in the <a href="Raster-data-CC46.md">CC46 tutorial</a>.</p>
<pre class="prettyprint source lang-html"><code>&lt;!DOCTYPE html>
&lt;html>
    &lt;head>
        &lt;meta charset=&quot;UTF-8&quot;>
        &lt;title>Vector data on ground&lt;/title>
        &lt;style>
            html { height: 100%; }
            body { margin: 0; overflow: hidden; height: 100%; }
            #viewerDiv { margin: auto; height: 100%; width: 100%; padding: 0; }
            canvas { display: block }
        &lt;/style>
    &lt;/head>
    &lt;body>
        &lt;div id=&quot;viewerDiv&quot;>&lt;/div>
        &lt;script src=&quot;js/itowns.js&quot;>&lt;/script>
        &lt;script type=&quot;text/javascript&quot;>

            // Retrieve the view container
            const viewerDiv = document.getElementById('viewerDiv');

            // Define the view geographic extent
            itowns.proj4.defs(
                'EPSG:3946',
                '+proj=lcc +lat_1=45.25 +lat_2=46.75 +lat_0=46 +lon_0=3 +x_0=1700000 +y_0=5200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
            );
            const viewExtent = new itowns.Extent(
                'EPSG:3946',
                1837816.94334, 1847692.32501,
                5170036.4587, 5178412.82698,
            );

            // Define the camera initial placement
            const placement = {
                coord: viewExtent.center(),
                tilt: 12,
                heading: 40,
                range: 6200,
            };

            // Create the planar view
            const view = new itowns.PlanarView(viewerDiv, viewExtent, {
                placement: placement,
            });

            // Define the source of the ortho-images
            const sourceOrtho = new itowns.WMSSource({
                url: 'https://download.data.grandlyon.com/wms/grandlyon',
                name: 'Ortho2009_vue_ensemble_16cm_CC46',
                format: 'image/jpeg',
                crs: 'EPSG:3946',
                extent: viewExtent,
            });
            // Create the ortho-images ColorLayer and add it to the view
            const layerOrtho = new itowns.ColorLayer('Ortho', { source: sourceOrtho });
            view.addLayer(layerOrtho);

            // Define the source of the dem data
            const sourceDEM = new itowns.WMSSource({
                url: 'https://download.data.grandlyon.com/wms/grandlyon',
                name: 'MNT2012_Altitude_10m_CC46',
                format: 'image/jpeg',
                crs: 'EPSG:3946',
                extent: viewExtent,
            });
            // Create the dem ElevationLayer and add it to the view
            const layerDEM = new itowns.ElevationLayer('DEM', {
                source: sourceDEM,
                useColorTextureElevation: true,
                colorTextureElevationMinZ: 144,
                colorTextureElevationMaxZ: 622,
            });
            view.addLayer(layerDEM);

        &lt;/script>
    &lt;/body>
&lt;/html>
</code></pre>
<h2>Display river areas on the ground</h2>
<p>The first mandatory thing we need to do for our river areas vector data to be displayed is to define their source.
Our data is contained within a GeoJSON file, so we can use iTowns <code><a onclick="window.parent.goTo('api/Source/FileSource.html','api/Source/FileSource')" title="FileSource">FileSource</a></code> :</p>
<pre class="prettyprint source lang-js"><code>const hydroSource = new itowns.FileSource({
    url: 'https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-hydro.geojson',
    crs: 'EPSG:4326',
    format: 'application/json',
});
</code></pre>
<p>We give three arguments to our <code>FileSource</code>, which are pretty self-explanatory.
The <code>url</code> and <code>crs</code> define the URL at which our file can be found, and the Coordinates Reference System (CRS) of the data contained within the file.
The <code>format</code> parameter defines the format of our file.
ITowns needs this format to determine which method it shall use to download data and transform them into iTowns understandable objects.</p>
<p>Now that the source of our vector data is set, we need to create a <code>Layer</code> which will contain the data.
We want our vector data to be displayed as flattened on the ground entities.
To obtain this result, the data must be contained in a <code><a onclick="window.parent.goTo('api/Layer/ColorLayer.html','api/Layer/ColorLayer')" title="ColorLayer">ColorLayer</a></code>.
We can therefore create our data <code>ColorLayer</code> and add it to our <code>GlobeView</code> as such :</p>
<pre class="prettyprint source lang-js"><code>const hydroLayer = new itowns.ColorLayer('hydro', {
    source: hydroSource,
});
view.addLayer(hydroLayer);
</code></pre>
<p>Doing this will result visually in nothing.
That is because we did not yet define a <code>Style</code> for our vector data.
To be more precise, our data consist in polygons, and we did not tell iTowns which appearance it should use to display these polygons, so iTowns did not display them.
We can correct this by creating a <code><a onclick="window.parent.goTo('api/Base/Style.html','api/Base/Style')" title="Style">Style</a></code> and applying it to our <code>ColorLayer</code> :</p>
<pre class="prettyprint source lang-js"><code>const hydroStyle = new itowns.Style({
    fill: {
        color: 'cyan',
        opacity: 0.5,
    },
    stroke: {
        color: 'blue',
    },
});

const hydroLayer = new itowns.ColorLayer('hydro', {
    source: hydroSource,
    style: hydroStyle,
});
</code></pre>
<p>In this code sample, we simply told iTowns to color all polygons' interior (accessed with the <code>fill</code> parameter) in cyan with a 50% transparency.
We also told iTowns to color the edges of the polygons (accessed with the <code>stroke</code> parameter) in blue.
The result is the following :</p>
<p><strong>TODO : change image</strong>
<img src="images/Vector-data-on-ground-1.png" alt="blue polygons"></p>
<h2>Display important transportation axises</h2>
<p>The process of displaying data about transportation axises is almost exactly the same as for the river areas.
We must first define the source of our data (a GeoJSON file in our case) :</p>
<pre class="prettyprint source lang-js"><code>const roadSource = new itowns.FileSource({
    url: 'https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-roads.geojson',
    crs: 'EPSG:4326',
    format: 'application/json',
});
</code></pre>
<p>Then we can define the <code>Style</code> with which our data shall be displayed :</p>
<pre class="prettyprint source lang-js"><code>const roadStyle = new itowns.Style({
    stroke: {
        color: 'red',
        width: 3,
    },
});
</code></pre>
<p>Here, we decided of the following style concerning the content of our data :</p>
<ul>
<li>Polygons' edges shall be colored in red.</li>
<li></li>
</ul>
<p>Finally, we can create a <code>ColorLayer</code> to support our data, and add it to the view :</p>
<pre class="prettyprint source lang-js"><code>const roadLayer = new itowns.ColorLayer('cities', {
    source: roadSource,
    style: roadStyle,
});
view.addLayer(roadLayer);
</code></pre>
<p>The result is the following :</p>
<p><strong>TODO : change image</strong>
<img src="images/Vector-data-on-ground-2.png" alt="flood and cities"></p>
<h2>Result</h2>
<p>By reaching here, you are now able to display simple vector data projected on the ground. The final code to do so is the following :</p>
<pre class="prettyprint source lang-html"><code>&lt;!DOCTYPE html>
&lt;html>
    &lt;head>
        &lt;meta charset=&quot;UTF-8&quot;>
        &lt;title>Vector data on ground&lt;/title>
        &lt;style>
            html { height: 100%; }
            body { margin: 0; overflow: hidden; height: 100%; }
            #viewerDiv { margin: auto; height: 100%; width: 100%; padding: 0; }
            canvas { display: block }
        &lt;/style>
    &lt;/head>
    &lt;body>
        &lt;div id=&quot;viewerDiv&quot;>&lt;/div>
        &lt;script src=&quot;js/itowns.js&quot;>&lt;/script>
        &lt;script type=&quot;text/javascript&quot;>

            // Retrieve the view container
            const viewerDiv = document.getElementById('viewerDiv');

            // Define the view geographic extent
            itowns.proj4.defs(
                'EPSG:3946',
                '+proj=lcc +lat_1=45.25 +lat_2=46.75 +lat_0=46 +lon_0=3 +x_0=1700000 +y_0=5200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
            );
            const viewExtent = new itowns.Extent(
                'EPSG:3946',
                1837816.94334, 1847692.32501,
                5170036.4587, 5178412.82698,
            );

            // Define the camera initial placement
            const placement = {
                coord: viewExtent.center(),
                tilt: 12,
                heading: 40,
                range: 6200,
            };

            // Create the planar view
            const view = new itowns.PlanarView(viewerDiv, viewExtent, {
                placement: placement,
            });

            // Define the source of the ortho-images
            const sourceOrtho = new itowns.WMSSource({
                url: 'https://download.data.grandlyon.com/wms/grandlyon',
                name: 'Ortho2009_vue_ensemble_16cm_CC46',
                format: 'image/jpeg',
                crs: 'EPSG:3946',
                extent: viewExtent,
            });
            // Create the ortho-images ColorLayer and add it to the view
            const layerOrtho = new itowns.ColorLayer('Ortho', { source: sourceOrtho });
            view.addLayer(layerOrtho);

            // Define the source of the dem data
            const sourceDEM = new itowns.WMSSource({
                url: 'https://download.data.grandlyon.com/wms/grandlyon',
                name: 'MNT2012_Altitude_10m_CC46',
                format: 'image/jpeg',
                crs: 'EPSG:3946',
                extent: viewExtent,
            });
            // Create the dem ElevationLayer and add it to the view
            const layerDEM = new itowns.ElevationLayer('DEM', {
                source: sourceDEM,
                useColorTextureElevation: true,
                colorTextureElevationMinZ: 144,
                colorTextureElevationMaxZ: 622,
            });
            view.addLayer(layerDEM);

            // Define a Source for the river areas
            const hydroSource = new itowns.FileSource({
                url: 'https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-hydro.geojson',
                crs: 'EPSG:4326',
                format: 'application/json',
            });

            // Define a Style for the river areas
            const hydroStyle = new itowns.Style({
                fill: {
                    color: 'cyan',
                    opacity: 0.5,
                },
                stroke: {
                    color: 'blue',
                },
            });

            // Create a river areas ColorLayer and add it to the view
            const hydroLayer = new itowns.ColorLayer('hydro', {
                source: hydroSource,
                style: hydroStyle,
            });
            view.addLayer(hydroLayer);

            // Define a Source for the transportation axises
            const roadSource = new itowns.FileSource({
                url: 'https://raw.githubusercontent.com/iTowns/iTowns2-sample-data/master/lyon-roads.geojson',
                crs: 'EPSG:4326',
                format: 'application/json',
            });

            // Define a Style for the transportation axises
            const roadStyle = new itowns.Style({
                stroke: {
                    color: 'red',
                    width: 3,
                },
            });

            // Create a transportation axises ColorLayer and add it to the view
            const roadLayer = new itowns.ColorLayer('cities', {
                source: roadSource,
                style: roadStyle,
            });
            view.addLayer(roadLayer);
            
        &lt;/script>
    &lt;/body>
&lt;/html>
</code></pre>
</article>

</section>

<script> prettyPrint(); </script>
<script src="../scripts/linenumber.js"> </script>
</body>
</html>